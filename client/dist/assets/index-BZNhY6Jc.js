import{r as i,j as e,u as _}from"./index-tGqmFr2s.js";import{a as M,c as O}from"./index-CAWDq06S.js";import{B as I}from"./index-DFboXxjU.js";import{c as S,b as B}from"./dealService-B78jylFK.js";import{a as z}from"./AuthService-BCbuW5zk.js";import{g as P,u as J,a as L,d as W}from"./companyService-BOlPcHKT.js";import{a as X,S as q}from"./index-DwED7RO3.js";import{e as G,n as H,a as K}from"./investorGrossTotal-5VNPN936.js";import{g as Q}from"./index-DKtXguSN.js";import"./iconBase-CRqKZK11.js";const Y=({setIsNew:x,companyId:m,reFetch:p})=>{const[s,g]=i.useState({}),[o,N]=i.useState([]),[u,v]=i.useState([]),[c,a]=i.useState({currency:"EUR"}),[h,b]=i.useState(""),[y,R]=i.useState(.94),[U,A]=i.useState(0);i.useEffect(()=>{(async()=>{const n=await P(m);b(n)})()},[m]),i.useEffect(()=>{(async()=>{var d;const{data:n}=await X.get(`https://api.frankfurter.app/latest?from=${c==null?void 0:c.currency}`),r=await G(c==null?void 0:c.currency,s==null?void 0:s.investedDate);A(((d=n==null?void 0:n.rates)==null?void 0:d.EUR)||1),R(r||1)})()},[c==null?void 0:c.currency,s==null?void 0:s.investedDate]),i.useEffect(()=>{(async()=>{const n=await z("CUSTOMER");v(n)})()},[]);const V=()=>{N([...o,{name:"",amount:"",entryFee:"",carried:""}])},k=t=>{const n=o.filter((r,d)=>d!==t);N(n)},f=async(t,n)=>{const{name:r,value:d}=n.target,C=await Promise.all(o.map(async(l,$)=>{if($===t){const j={...l,[r]:d},F=parseInt(j.amount||0),w=parseFloat(j.entryFee||0),D=parseFloat(j.carried||0),E=parseFloat(j.shareholding||0);return j.fees=F*w/100,j.profit=await H((F+F*w/100)*y,E,s==null?void 0:s.currentValue,c==null?void 0:c.currency,D/100),j.moic=await K((F+F*w/100)*y,E,s==null?void 0:s.currentValue,c==null?void 0:c.currency,D/100),j}return l}));N(C)},T=async t=>{t.preventDefault();const n=o==null?void 0:o.map(l=>({...l,amount:parseInt((l==null?void 0:l.amount)||0)*y,fees:parseFloat((l==null?void 0:l.fees)||0)*y})),r={...s,currency:c==null?void 0:c.currency,investors:n,companyId:m};let d;!h.dealSummary||!h.dealSummary.investDate?d=s==null?void 0:s.investedDate:d=h==null?void 0:h.dealSummary.investDate,await J(m,{investDate:d,currentValuation:s==null?void 0:s.currentValue}),await B(r)&&(p(),x(!1))};return e.jsx("div",{className:"pop",children:e.jsxs("div",{className:"pop-body col-10 pb-5",children:[e.jsx("div",{className:"text-end",children:e.jsx(I,{onClick:()=>x(t=>!t),className:"cursor-pointer",size:30})}),e.jsx("h5",{className:"text-center mb-4 fs-3 fw-bold",children:"Add a deal"}),e.jsx("form",{onSubmit:T,children:e.jsxs("div",{className:"d-flex flex-column gap-4 col-md-10 mx-auto",children:[e.jsxs("div",{className:"d-flex gap-3 justify-content-end",children:[e.jsxs("div",{children:[e.jsx("div",{children:" old Rate "}),e.jsxs("div",{className:"text-center text-red",children:[y," €"]})]}),e.jsxs("div",{children:[e.jsx("div",{children:" Current Rate "}),e.jsxs("div",{className:"text-center text-success",children:[U," €"]})]})]}),e.jsxs("div",{className:"d-flex gap-4 align-items-center",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"valuation",children:"Current valuation"}),e.jsx("input",{type:"text",name:"valuation",value:s==null?void 0:s.currentValue,onChange:t=>{g({...s,currentValue:t.target.value})},className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"date",children:"Investment date"}),e.jsx("input",{type:"date",name:"date",onChange:t=>g({...s,investedDate:t.target.value}),className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"date",children:"Currency"}),e.jsxs("select",{onChange:t=>a(JSON.parse(t.target.value)),name:"",id:"",className:"input-field",children:[e.jsx("option",{value:JSON.stringify({currency:"EUR"}),children:"Euro"}),e.jsx("option",{value:JSON.stringify({currency:"USD"}),children:"US Dollar"})]})]})]}),o.map((t,n)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border border-3 p-3 rounded-5 border-secondary position-relative",children:[e.jsxs("div",{className:"d-flex gap-4 align-items-center",children:[e.jsxs("div",{className:"field w-50",children:[e.jsx("label",{htmlFor:`name-${n}`,children:"Select Investors"}),e.jsx("div",{className:"input-field w-100",children:e.jsxs("select",{name:"investerId",value:t.investerId,onChange:r=>f(n,r),style:{outline:"none"},className:"border-0 bg-transparent w-100",children:[e.jsx("option",{value:"",children:"Select Investor"}),(u==null?void 0:u.length)>0&&u.map((r,d)=>{var C,l;return e.jsxs("option",{value:r==null?void 0:r._id,children:[(C=r==null?void 0:r.personal)==null?void 0:C.firstName," ",(l=r==null?void 0:r.personal)==null?void 0:l.lastName]},d)})]})})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`amount-${n}`,children:"Amount invested"}),e.jsx("input",{type:"text",name:"amount",value:t.amount,className:"input-field",onChange:r=>f(n,r)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`entryFee-${n}`,children:" Entry Fee (%)"}),e.jsx("input",{type:"text",name:"entryFee",value:t.entryFee,className:"input-field",onChange:r=>f(n,r)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`carried-${n}`,children:"Carried (%)"}),e.jsx("input",{type:"text",name:"carried",value:t.carried,className:"input-field",onChange:r=>f(n,r)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`share-${n}`,children:" Shareholding (%)"}),e.jsx("input",{type:"text",name:"shareholding",value:t.shareholding,className:"input-field",onChange:r=>f(n,r)})]}),e.jsx("div",{className:"d-flex gap-2 mt-auto align-items-center",children:e.jsx("button",{type:"button",style:{width:"50px",aspectRatio:"1/1"},onClick:()=>k(n),className:"btn-gray p-0 rounded-circle position-absolute close-investor",children:e.jsx(I,{size:20})})})]},n),e.jsxs("div",{className:"d-flex gap-4 mt-3",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Amount paid in euro"}),e.jsx("input",{type:"text",value:S((parseInt((t==null?void 0:t.amount)||0)+parseFloat((t==null?void 0:t.fees)||0))*y),className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net Profit "}),e.jsx("input",{type:"text",value:S(t==null?void 0:t.profit),className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net MOIC"}),e.jsx("input",{type:"text",value:t==null?void 0:t.moic,className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net IRR"}),e.jsx("input",{type:"text",value:"N.M",className:"input-field bg-white border border-2",disabled:!0})]})]})]})})),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",className:`btn-${o.length<=0?"red":"gray"} rounded-5 col-5`,onClick:V,children:"Add an investor"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:`btn-${o.length<=0?"gray":"red"} rounded-5 col-5`,children:"Save"})})]})})]})})},de=()=>{const[x,m]=i.useState(!1),[p,s]=i.useState([]),[g,o]=i.useState(""),N=_(),u=async()=>{const a=await L();s(a)};i.useEffect(()=>{u()},[]);const v=async a=>{s(h=>h.filter(b=>b._id!==a)),await W(a)},c=()=>{u()};return e.jsxs("div",{className:"bg-white company h-100 ",children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Logo"}),e.jsx("th",{scope:"col",children:"Name"}),e.jsx("th",{scope:"col",children:"CUMULATED INVESTMENT"}),e.jsx("th",{scope:"col",children:"CURRENT VALUATION "}),e.jsx("th",{scope:"col"})]})}),e.jsx("tbody",{children:p&&(p==null?void 0:p.map((a,h)=>{var b;return e.jsxs("tr",{className:" ",children:[e.jsx("td",{children:e.jsxs("div",{style:{width:"60px",aspectRatio:"1/1"},children:["   ",e.jsx("img",{className:"w-100 h-100 rounded-circle",src:q+(a==null?void 0:a.profile),alt:""})]})}),e.jsx("td",{className:"text-uppercase ",children:a==null?void 0:a.name}),e.jsx(Z,{id:a==null?void 0:a._id}),e.jsxs("td",{children:[" ",S((b=a==null?void 0:a.dealSummary)==null?void 0:b.currentValuation)]}),e.jsxs("td",{className:"d-flex gap-4",children:[e.jsx("button",{className:"btn-red",onClick:()=>{m(!x),o(a==null?void 0:a._id)},children:"Create a deal"}),e.jsx("button",{onClick:()=>N("new-company",{state:a==null?void 0:a._id}),className:"btn text-primary bg-very-light-gray rounded-circle",children:e.jsx(M,{size:20})}),e.jsx("button",{onClick:()=>v(a==null?void 0:a._id),className:"btn text-danger bg-very-light-gray rounded-circle",children:e.jsx(O,{size:20})})]})]},h)}))})]}),x&&e.jsx(Y,{reFetch:c,companyId:g,setIsNew:m})]})},Z=({id:x})=>{const[m,p]=i.useState(0),[s,g]=i.useState(0);return i.useEffect(()=>{(async()=>{const{totalInvestment:N,current:u}=await Q(x);p(N),g(u)})()},[x]),e.jsx(e.Fragment,{children:e.jsxs("td",{children:[" ",S(m)]})})};export{de as default};
