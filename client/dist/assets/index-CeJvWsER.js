import{r as c,j as e,u as v}from"./index-NMcxTmgD.js";import{a as T,c as V}from"./index-CgF78f03.js";import{B as w,a as _}from"./index-BEy_jSg6.js";import{b as $,c as E}from"./dealService-DDX68bKE.js";import{a as z}from"./AuthService-C61-47cD.js";import{g as B,u as O,a as J,d as L}from"./companyService-X2H5xe5F.js";import{a as M,S as P}from"./index-D22hh-16.js";import{g as W}from"./index-B4tZI1v4.js";import"./iconBase-B098WwbS.js";const X=({setIsNew:p,companyId:d,reFetch:x})=>{const[r,y]=c.useState({}),[l,j]=c.useState([]),[m,S]=c.useState([]),[o,t]=c.useState({currency:"EUR"}),[u,f]=c.useState(""),[C,D]=c.useState(.94);c.useEffect(()=>{(async()=>{const n=await B(d);f(n)})()},[d]),c.useEffect(()=>{(async()=>{var s;const{data:n}=await M.get(`https://api.frankfurter.app/latest?from=${o==null?void 0:o.currency}`);D(((s=n==null?void 0:n.rates)==null?void 0:s.EUR)||1)})()},[o==null?void 0:o.currency]),c.useEffect(()=>{(async()=>{const n=await z("CUSTOMER");S(n)})()},[]);const F=()=>{j([...l,{name:"",amount:"",entryFee:"",carried:""}])},I=a=>{const n=l.filter((s,h)=>h!==a);j(n)},g=(a,n)=>{const{name:s,value:h}=n.target,N=l.map((i,U)=>{if(U===a){const b={...i,[s]:h},A=parseInt(b.amount||0),k=parseInt(b.entryFee||0);return parseInt(b.carried||0),b.fees=A*k/100,b}return i});j(N)},R=async a=>{a.preventDefault();const n=l==null?void 0:l.map(i=>({...i,amount:parseInt((i==null?void 0:i.amount)||0)*C,fees:parseFloat((i==null?void 0:i.fees)||0)*C})),s={...r,currency:o==null?void 0:o.currency,investors:n,companyId:d};let h;!u.dealSummary||!u.dealSummary.investDate?h=r==null?void 0:r.investedDate:h=u==null?void 0:u.dealSummary.investDate,await O(d,{investDate:h,currentValuation:r==null?void 0:r.currentValue}),await $(s)&&(x(),p(!1))};return e.jsx("div",{className:"pop",children:e.jsxs("div",{className:"pop-body col-10 pb-5",children:[e.jsx("div",{className:"text-end",children:e.jsx(w,{onClick:()=>p(a=>!a),className:"cursor-pointer",size:30})}),e.jsx("h5",{className:"text-center mb-4 fs-4",children:"Add a deal"}),e.jsx("form",{onSubmit:R,children:e.jsxs("div",{className:"d-flex flex-column gap-4 col-md-10 mx-auto",children:[e.jsxs("div",{className:"d-flex gap-4 align-items-center",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"valuation",children:"Current valuation"}),e.jsx("input",{type:"text",name:"valuation",value:r==null?void 0:r.currentValue,onChange:a=>y({...r,currentValue:a.target.value}),className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"date",children:"Investment date"}),e.jsx("input",{type:"date",name:"date",onChange:a=>y({...r,investedDate:a.target.value}),className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"date",children:"Currency"}),e.jsxs("select",{onChange:a=>t(JSON.parse(a.target.value)),name:"",id:"",className:"input-field",children:[e.jsx("option",{value:JSON.stringify({currency:"EUR"}),children:"Euro"}),e.jsx("option",{value:JSON.stringify({currency:"USD"}),children:"US Dollar"})]})]})]}),l.map((a,n)=>e.jsxs("div",{className:"d-flex gap-4 align-items-center",children:[e.jsxs("div",{className:"field w-50",children:[e.jsx("label",{htmlFor:`name-${n}`,children:"Select Investors"}),e.jsx("div",{className:"input-field w-100",children:e.jsxs("select",{name:"investerId",value:a.investerId,onChange:s=>g(n,s),style:{outline:"none"},className:"border-0 bg-transparent w-100",children:[e.jsx("option",{value:"",children:"Select Investor"}),(m==null?void 0:m.length)>0&&m.map((s,h)=>{var N,i;return e.jsxs("option",{value:s==null?void 0:s._id,children:[(N=s==null?void 0:s.personal)==null?void 0:N.firstName," ",(i=s==null?void 0:s.personal)==null?void 0:i.lastName]},h)})]})})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`amount-${n}`,children:"Amount invested"}),e.jsx("input",{type:"text",name:"amount",value:a.amount,className:"input-field",onChange:s=>g(n,s)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`entryFee-${n}`,children:" Entry Fee (%)"}),e.jsx("input",{type:"text",name:"entryFee",value:a.entryFee,className:"input-field",onChange:s=>g(n,s)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`carried-${n}`,children:"Carried (%)"}),e.jsx("input",{type:"text",name:"carried",value:a.carried,className:"input-field",onChange:s=>g(n,s)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`share-${n}`,children:" Shareholding (%)"}),e.jsx("input",{type:"text",name:"shareholding",value:a.shareholding,className:"input-field",onChange:s=>g(n,s)})]}),e.jsxs("div",{className:"d-flex gap-2 mt-auto align-items-center",children:[e.jsx("button",{type:"button",onClick:F,style:{width:"50px",aspectRatio:"1/1"},className:"btn-red p-0 rounded-circle",children:e.jsx(_,{size:20})}),e.jsx("button",{type:"button",style:{width:"50px",aspectRatio:"1/1"},onClick:()=>I(n),className:"btn-gray p-0 rounded-circle",children:e.jsx(w,{size:20})})]})]},n)),l.length<=0&&e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",className:"btn-red rounded-5 col-5",onClick:F,children:"Add an investor"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:`btn-${l.length<=0?"gray":"red"} rounded-5 col-5`,children:"Save"})})]})})]})})},ne=()=>{const[p,d]=c.useState(!1),[x,r]=c.useState([]),[y,l]=c.useState(""),j=v(),m=async()=>{const t=await J();r(t)};c.useEffect(()=>{m()},[]);const S=async t=>{r(u=>u.filter(f=>f._id!==t)),await L(t)},o=()=>{m()};return e.jsxs("div",{className:"bg-white company h-100 ",children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Logo"}),e.jsx("th",{scope:"col",children:"Name"}),e.jsx("th",{scope:"col",children:"CUMULATED INVESTMENT"}),e.jsx("th",{scope:"col",children:"CURRENT VALUATION "}),e.jsx("th",{scope:"col"})]})}),e.jsx("tbody",{children:x&&(x==null?void 0:x.map((t,u)=>{var f;return e.jsxs("tr",{className:" ",children:[e.jsx("td",{children:e.jsxs("div",{style:{width:"60px",aspectRatio:"1/1"},children:["   ",e.jsx("img",{className:"w-100 h-100 rounded-circle",src:P+(t==null?void 0:t.profile),alt:""})]})}),e.jsx("td",{className:"text-uppercase ",children:t==null?void 0:t.name}),e.jsx(q,{id:t==null?void 0:t._id}),e.jsxs("td",{children:[" ",E((f=t==null?void 0:t.dealSummary)==null?void 0:f.currentValuation)]}),e.jsxs("td",{className:"d-flex gap-4",children:[e.jsx("button",{className:"btn-red",onClick:()=>{d(!p),l(t==null?void 0:t._id)},children:"Create a deal"}),e.jsx("button",{onClick:()=>j("new-company",{state:t==null?void 0:t._id}),className:"btn text-primary bg-very-light-gray rounded-circle",children:e.jsx(T,{size:20})}),e.jsx("button",{onClick:()=>S(t==null?void 0:t._id),className:"btn text-danger bg-very-light-gray rounded-circle",children:e.jsx(V,{size:20})})]})]},u)}))})]}),p&&e.jsx(X,{reFetch:o,companyId:y,setIsNew:d})]})},q=({id:p})=>{const[d,x]=c.useState(0),[r,y]=c.useState(0);return c.useEffect(()=>{(async()=>{const{totalInvestment:j,current:m}=await W(p);x(j),y(m)})()},[p]),e.jsx(e.Fragment,{children:e.jsxs("td",{children:[" ",E(d)]})})};export{ne as default};
