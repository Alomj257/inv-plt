import{r as i,j as e,c as S,h as _,m as M,n as O,b as B,o as z,p as P,q as J,s as L,u as q,S as W,t as X,v as G}from"./index-Dll_1HP0.js";import{b as H,d as K}from"./index-CXbA1jBV.js";import{B as I}from"./index-CAi8zhoe.js";import{g as Q}from"./index-Cgy4A4Qz.js";import"./iconBase-D8TNORit.js";const Y=({setIsNew:x,companyId:m,reFetch:p})=>{const[s,g]=i.useState({}),[d,N]=i.useState([]),[h,w]=i.useState([]),[c,a]=i.useState({currency:"EUR"}),[u,b]=i.useState(""),[y,R]=i.useState(.94),[U,A]=i.useState(0);i.useEffect(()=>{(async()=>{const n=await _(m);b(n)})()},[m]),i.useEffect(()=>{(async()=>{var o;const{data:n}=await M.get(`https://api.frankfurter.app/latest?from=${c==null?void 0:c.currency}`),r=await O(c==null?void 0:c.currency,s==null?void 0:s.investedDate);A(((o=n==null?void 0:n.rates)==null?void 0:o.EUR)||1),R(r||1)})()},[c==null?void 0:c.currency,s==null?void 0:s.investedDate]),i.useEffect(()=>{(async()=>{const n=await B("CUSTOMER");w(n)})()},[]);const V=()=>{N([...d,{name:"",amount:"",entryFee:"",carried:""}])},k=t=>{const n=d.filter((r,o)=>o!==t);N(n)},f=async(t,n)=>{const{name:r,value:o}=n.target,C=await Promise.all(d.map(async(l,$)=>{if($===t){const j={...l,[r]:o},F=parseInt(j.amount||0),v=parseFloat(j.entryFee||0),D=parseFloat(j.carried||0),E=parseFloat(j.shareholding||0);return j.fees=F*v/100,j.profit=await z((F+F*v/100)*y,E,s==null?void 0:s.currentValue,c==null?void 0:c.currency,D/100),j.moic=await P((F+F*v/100)*y,E,s==null?void 0:s.currentValue,c==null?void 0:c.currency,D/100),j}return l}));N(C)},T=async t=>{t.preventDefault();const n=d==null?void 0:d.map(l=>({...l,amount:parseInt((l==null?void 0:l.amount)||0)*y,invest:parseInt((l==null?void 0:l.amount)||0),fees:parseFloat((l==null?void 0:l.fees)||0)*y})),r={...s,currency:c==null?void 0:c.currency,investors:n,companyId:m};let o;!u.dealSummary||!u.dealSummary.investDate?o=s==null?void 0:s.investedDate:o=u==null?void 0:u.dealSummary.investDate,await J(m,{investDate:o,currentValuation:s==null?void 0:s.currentValue}),await L(r)&&(p(),x(!1))};return e.jsx("div",{className:"pop",children:e.jsxs("div",{className:"pop-body col-10 pb-5",children:[e.jsx("div",{className:"text-end",children:e.jsx(I,{onClick:()=>x(t=>!t),className:"cursor-pointer",size:30})}),e.jsx("h5",{className:"text-center mb-4 fs-3 fw-bold",children:"Add a deal"}),e.jsx("form",{onSubmit:T,children:e.jsxs("div",{className:"d-flex flex-column gap-4 col-md-10 mx-auto",children:[e.jsxs("div",{className:"d-flex gap-3 justify-content-end",children:[e.jsxs("div",{children:[e.jsx("div",{children:" old Rate "}),e.jsxs("div",{className:"text-center text-red",children:[y," €"]})]}),e.jsxs("div",{children:[e.jsx("div",{children:" Current Rate "}),e.jsxs("div",{className:"text-center text-success",children:[U," €"]})]})]}),e.jsxs("div",{className:"d-flex gap-4 align-items-center",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"valuation",children:"Current valuation"}),e.jsx("input",{type:"text",name:"valuation",value:s==null?void 0:s.currentValue,onChange:t=>{g({...s,currentValue:t.target.value})},className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"date",children:"Investment date"}),e.jsx("input",{type:"date",name:"date",onChange:t=>g({...s,investedDate:t.target.value}),className:"input-field"})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"date",children:"Currency"}),e.jsxs("select",{onChange:t=>a(JSON.parse(t.target.value)),name:"",id:"",className:"input-field",children:[e.jsx("option",{value:JSON.stringify({currency:"EUR"}),children:"Euro"}),e.jsx("option",{value:JSON.stringify({currency:"USD"}),children:"US Dollar"})]})]})]}),d.map((t,n)=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"border border-3 p-3 rounded-5 border-secondary position-relative",children:[e.jsxs("div",{className:"d-flex gap-4 align-items-center",children:[e.jsxs("div",{className:"field w-50",children:[e.jsx("label",{htmlFor:`name-${n}`,children:"Select Investors"}),e.jsx("div",{className:"input-field w-100",children:e.jsxs("select",{name:"investerId",value:t.investerId,onChange:r=>f(n,r),style:{outline:"none"},className:"border-0 bg-transparent w-100",children:[e.jsx("option",{value:"",children:"Select Investor"}),(h==null?void 0:h.length)>0&&h.map((r,o)=>{var C,l;return e.jsxs("option",{value:r==null?void 0:r._id,children:[(C=r==null?void 0:r.personal)==null?void 0:C.firstName," ",(l=r==null?void 0:r.personal)==null?void 0:l.lastName]},o)})]})})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`amount-${n}`,children:"Amount invested"}),e.jsx("input",{type:"text",name:"amount",value:t.amount,className:"input-field",onChange:r=>f(n,r)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`entryFee-${n}`,children:" Entry Fee (%)"}),e.jsx("input",{type:"text",name:"entryFee",value:t.entryFee,className:"input-field",onChange:r=>f(n,r)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`carried-${n}`,children:"Carried (%)"}),e.jsx("input",{type:"text",name:"carried",value:t.carried,className:"input-field",onChange:r=>f(n,r)})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:`share-${n}`,children:" Shareholding (%)"}),e.jsx("input",{type:"text",name:"shareholding",value:t.shareholding,className:"input-field",onChange:r=>f(n,r)})]}),e.jsx("div",{className:"d-flex gap-2 mt-auto align-items-center",children:e.jsx("button",{type:"button",style:{width:"50px",aspectRatio:"1/1"},onClick:()=>k(n),className:"btn-gray p-0 rounded-circle position-absolute close-investor",children:e.jsx(I,{size:20})})})]},n),e.jsxs("div",{className:"d-flex gap-4 mt-3",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Amount paid in euro"}),e.jsx("input",{type:"text",value:S((parseInt((t==null?void 0:t.amount)||0)+parseFloat((t==null?void 0:t.fees)||0))*y),className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net Profit "}),e.jsx("input",{type:"text",value:S(t==null?void 0:t.profit),className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net MOIC"}),e.jsx("input",{type:"text",value:t==null?void 0:t.moic,className:"input-field bg-white border border-2",disabled:!0})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{htmlFor:"",children:"Net IRR"}),e.jsx("input",{type:"text",value:"N.M",className:"input-field bg-white border border-2",disabled:!0})]})]})]})})),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",className:`btn-${d.length<=0?"red":"gray"} rounded-5 col-5`,onClick:V,children:"Add an investor"})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:`btn-${d.length<=0?"gray":"red"} rounded-5 col-5`,children:"Save"})})]})})]})})},re=()=>{const[x,m]=i.useState(!1),[p,s]=i.useState([]),[g,d]=i.useState(""),N=q(),h=async()=>{const a=await X();s(a)};i.useEffect(()=>{h()},[]);const w=async a=>{s(u=>u.filter(b=>b._id!==a)),await G(a)},c=()=>{h()};return e.jsxs("div",{className:"bg-white company h-100 ",children:[e.jsxs("table",{children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-0",scope:"col"}),e.jsx("th",{scope:"col",children:"Name"}),e.jsx("th",{scope:"col",children:"CUMULATED INVESTMENT"}),e.jsx("th",{scope:"col",children:"CURRENT VALUATION "}),e.jsx("th",{scope:"col"}),e.jsx("td",{style:{width:"60px",aspectRatio:"1/1"},className:"border-0"})]})}),e.jsx("tbody",{children:p&&(p==null?void 0:p.map((a,u)=>{var b;return e.jsxs("tr",{className:" ",children:[e.jsx("td",{children:e.jsxs("div",{style:{width:"60px",aspectRatio:"1/1",marginLeft:"20px"},children:["   ",e.jsx("img",{className:"w-100 h-100 rounded-circle",src:W+(a==null?void 0:a.profile),alt:""})]})}),e.jsx("td",{className:"text-uppercase ",children:a==null?void 0:a.name}),e.jsx(Z,{id:a==null?void 0:a._id}),e.jsxs("td",{children:[" ",S((b=a==null?void 0:a.dealSummary)==null?void 0:b.currentValuation)]}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-4",children:[e.jsx("button",{className:"btn-red",onClick:()=>{m(!x),d(a==null?void 0:a._id)},children:"Create a deal"}),e.jsx("button",{onClick:()=>N("new-company",{state:a==null?void 0:a._id}),className:"btn text-primary bg-very-light-gray rounded-circle",children:e.jsx(H,{size:20})}),e.jsx("button",{onClick:()=>w(a==null?void 0:a._id),className:"btn text-danger bg-very-light-gray rounded-circle",children:e.jsx(K,{size:20})})]})}),e.jsx("td",{style:{width:"60px",aspectRatio:"1/1"}})]},u)}))})]}),x&&e.jsx(Y,{reFetch:c,companyId:g,setIsNew:m})]})},Z=({id:x})=>{const[m,p]=i.useState(0),[s,g]=i.useState(0);return i.useEffect(()=>{(async()=>{const{totalInvestment:N,current:h}=await Q(x);p(N),g(h)})()},[x]),e.jsx(e.Fragment,{children:e.jsxs("td",{children:[" ",S(m)]})})};export{re as default};
