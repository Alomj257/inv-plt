import{r as I,j as e,u as A,g as M}from"./index-NMcxTmgD.js";import{B as R}from"./index-BEy_jSg6.js";import{a as m,S as C}from"./index-D22hh-16.js";import{g as D,c as b}from"./dealService-DDX68bKE.js";const Y=(n,s)=>{try{let r=0;const c=[];return n.forEach(i=>{var u;(u=i==null?void 0:i.deals)==null||u.forEach(t=>{var E;r+=parseInt((t==null?void 0:t.currentValue)||0);const j=(E=t==null?void 0:t.investors)==null?void 0:E.find(g=>(g==null?void 0:g.investerId)===s);j&&c.push([parseInt((j==null?void 0:j.amount)||0),new Date(t==null?void 0:t.investedDate)])})}),{totalCurrentValue:r,currentDate:new Date,investments:c}}catch(r){return console.log(r),null}};function $(n,s,r){let c=0,h=0;return n.forEach(([u,t])=>{c+=u;const j=(s-t)/(365*24*60*60*1e3);h+=u/c*j}),(((r/c)**(1/h)-1)*100).toFixed(1)}function k(n,s,r,c){const h=(c-s)/31536e6;return(((r/n)**(1/h)-1)*100).toFixed(4)}const S=async(n,s,r,c,h)=>{console.log(c);const i=await O(c),u=s*parseInt(r||0)*i/100-n;return u>0?u:u*(1-h)},F=async(n,s,r,c,h)=>((await S(n,s,r,c,h)+n)/n).toFixed(2),O=async n=>{var r;const{data:s}=await m.get(`https://api.frankfurter.app/latest?from=${n||"EUR"}`);return((r=s==null?void 0:s.rates)==null?void 0:r.EUR)||1},_=({deal:n,sector:s,currentValuation:r,userId:c})=>{const[h,i]=I.useState(0),[u,t]=I.useState(0),[j,E]=I.useState(0);return I.useEffect(()=>{(async()=>{const p=(await D(c)).reduce((l,x)=>{var o;const d=(o=x==null?void 0:x.investors)==null?void 0:o.find(f=>f.investerId===c);return l+parseInt((d==null?void 0:d.amount)||0,10)},0);E(p)})()},[c]),I.useEffect(()=>{n&&r&&(async()=>{var p;const a=(p=n==null?void 0:n.investors)==null?void 0:p.find(l=>l.investerId===c);if(a){const l=parseFloat((a==null?void 0:a.amount)||0)+parseFloat((a==null?void 0:a.fees)||0),x=parseFloat((a==null?void 0:a.carried)||0)/100,d=parseFloat((a==null?void 0:a.shareholding)||0),o=await S(l,d,r,n.currency,x),f=await F(l,d,r,n.currency,x);i(o),t(f)}})()},[r,c,n,j]),e.jsxs(e.Fragment,{children:[e.jsx("td",{children:h}),e.jsx("td",{children:s}),e.jsx("td",{children:u})]})},G=({setIsNew:n,company:s,deals:r,userId:c})=>{var u;const h=A(),i=(u=M())==null?void 0:u.user;return e.jsx("div",{className:"pop",children:e.jsxs("div",{className:"pop-body col-md-10",children:[e.jsx("div",{className:"text-end",children:e.jsx(R,{onClick:()=>n(t=>!t),className:"cursor-pointer",size:30})}),e.jsx("div",{className:"",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"thead-dark",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col text-uppercase ",children:" "}),e.jsx("th",{scope:"col text-uppercase ",children:" DEAL NAME"}),e.jsx("th",{scope:"col text-uppercase ",children:"ASSET ClASS "}),e.jsx("th",{scope:"col text-uppercase ",children:" INVESTMENT DATE"}),e.jsx("th",{scope:"col text-uppercase ",children:" INVESTMENT"}),e.jsx("th",{scope:"col text-uppercase ",children:"NET PROFIT(LOSS)"}),e.jsx("th",{scope:"col text-uppercase ",children:"SECTOR"}),e.jsx("th",{scope:"col text-uppercase ",children:"NET MOIC"}),e.jsx("th",{scope:"col text-uppercase ",children:"NET IRR "}),e.jsx("th",{scope:"col text-uppercase ",children:"WEIGHT "})]})}),e.jsx("tbody",{children:r==null?void 0:r.map((t,j)=>{var E,g,a,p,l,x,d,o,f;return e.jsxs("tr",{className:"p-3 ",children:[e.jsx("td",{children:e.jsxs("div",{onClick:()=>h("about",{state:s==null?void 0:s._id}),className:" ",style:{width:"50px",aspectRatio:"1/1"},children:["  ",e.jsx("img",{className:"w-100 h-100 rounded-circle",src:C+(s==null?void 0:s.profile)||(s==null?void 0:s.img),alt:""})]})}),e.jsx("td",{className:"text-capitalize",children:s==null?void 0:s.name}),e.jsx("td",{children:(E=s==null?void 0:s.dealSummary)==null?void 0:E.asset}),e.jsx("td",{children:t==null?void 0:t.investedDate}),e.jsxs("td",{children:[" ",b((t==null?void 0:t.investors)&&((a=(g=t==null?void 0:t.investors)==null?void 0:g.find(N=>N.investerId===(i==null?void 0:i._id)))==null?void 0:a.amount)||(t==null?void 0:t.investors)&&((l=(p=t==null?void 0:t.investors)==null?void 0:p.find(N=>N.investerId===c))==null?void 0:l.amount))]}),e.jsx(_,{deal:t,currentValuation:(x=s==null?void 0:s.dealSummary)==null?void 0:x.currentValuation,userId:c||(i==null?void 0:i._id),sector:(d=s==null?void 0:s.dealSummary)==null?void 0:d.sector}),e.jsx("td",{children:e.jsx(B,{initialInvestment:(t==null?void 0:t.investors)&&((f=(o=t==null?void 0:t.investors)==null?void 0:o.find(N=>N.investerId===(c||(i==null?void 0:i._id))))==null?void 0:f.amount),investmentDate:t==null?void 0:t.investedDate,currentValue:t==null?void 0:t.currentValue})}),e.jsx("td",{children:t==null?void 0:t.weight})]},j)})})]})})]})})},B=({initialInvestment:n,investmentDate:s,currentValue:r})=>{const[c,h]=I.useState(0);return I.useEffect(()=>{h(k(parseInt(n||0),new Date(s),parseInt(r||0),new Date))},[n,s,r]),e.jsxs(e.Fragment,{children:[" ",c]})},H=({deals:n,sector:s,currentValuation:r,userId:c})=>{const[h,i]=I.useState(0),[u,t]=I.useState(0),[j,E]=I.useState(0),g=async()=>{const p=(await D(c)).reduce((l,x)=>{var o;const d=(o=x==null?void 0:x.investors)==null?void 0:o.find(f=>f.investerId===c);return l+parseInt((d==null?void 0:d.amount)||0)},0);E(p)};return I.useEffect(()=>{const a=async()=>{var x;let p=0,l=0;for(const d of n){const o=(x=d==null?void 0:d.investors)==null?void 0:x.find(f=>f.investerId===c);if(o){const f=parseInt((o==null?void 0:o.amount)||0)+parseFloat((o==null?void 0:o.fees)||0),N=parseFloat((o==null?void 0:o.carried)||0),w=parseFloat((o==null?void 0:o.shareholding)||0),P=await S(f,w,r,d.currency,N/100),T=await F(f,w,r,d.currency,N/100);p+=P,l+=T}}i(p),t(l)};g().then(()=>a())},[r,c,n]),e.jsxs(e.Fragment,{children:[e.jsx("td",{children:h}),e.jsx("td",{children:s}),e.jsx("td",{children:u})]})};export{G as D,H as N,F as a,$ as c,O as e,S as n,Y as p};
